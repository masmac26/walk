<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Walk</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Go Outside!</h1>
  
  <!-- Timer Display -->
  <h2 id="timer">00:00:00</h2>
  
  <!-- Buttons -->
  <button id="startWalk" style="background-color: green; color: white; padding: 10px 20px; margin: 5px; border: none; border-radius: 8px; font-size: 16px;">
    â–¶ï¸ Start Walk
  </button>

  <button id="pauseWalk" style="background-color: yellow; color: black; padding: 10px 20px; margin: 5px; border: none; border-radius: 8px; font-size: 16px;">
    â¸ï¸ Pause Walk
  </button>

  <button id="endWalk" style="background-color: red; color: white; padding: 10px 20px; margin: 5px; border: none; border-radius: 8px; font-size: 16px;">
    ğŸ›‘ End Walk
  </button>

  <p id="challenge"></p>

  <!-- Bottom nav -->
  <div class="navbar">
    <a href="index.html" class="active">ğŸ  Home</a>
    <a href="journal.html">ğŸ“– Journal</a>
    <a href="settings.html">âš™ï¸ Settings</a>
  </div>

  <!-- Timer Script -->
  <script>
  let timerInterval = null;
  let totalSeconds = 0;
  let isPaused = false;

  function updateTimer() {
    let hours = Math.floor(totalSeconds / 3600);
    let minutes = Math.floor((totalSeconds % 3600) / 60);
    let seconds = totalSeconds % 60;

    document.getElementById("timer").textContent =
      String(hours).padStart(2, "0") + ":" +
      String(minutes).padStart(2, "0") + ":" +
      String(seconds).padStart(2, "0");
  }

  // ---- STREAK TRACKER ----
  function updateStreak() {
    const streakDiv = document.getElementById("streak");

    let data = JSON.parse(localStorage.getItem("walkStreak")) || {
      count: 0,
      lastDate: null
    };

    let today = new Date().toDateString();

    if (data.lastDate !== today) {
      if (data.lastDate) {
        let last = new Date(data.lastDate);
        let diff = (new Date(today) - last) / (1000 * 60 * 60 * 24);

        if (diff === 1) {
          data.count += 1; // consecutive day
        } else {
          data.count = 1; // missed a day
        }
      } else {
        data.count = 1; // first ever walk
      }
      data.lastDate = today;
      localStorage.setItem("walkStreak", JSON.stringify(data));
    }

    streakDiv.textContent = "ğŸ”¥ Streak: " + data.count + " day" + (data.count > 1 ? "s" : "");
  }

  // ---- BUTTONS ----
  document.getElementById("startWalk").onclick = function() {
    if (timerInterval === null) { 
      isPaused = false;
      timerInterval = setInterval(function() {
        if (!isPaused) {
          totalSeconds++;
          updateTimer();
        }
      }, 1000);
      updateStreak(); // update streak when walk starts
    }
  };

  document.getElementById("pauseWalk").onclick = function() {
    if (timerInterval !== null) {
      isPaused = !isPaused;
      this.textContent = isPaused ? "â–¶ï¸ Resume Walk" : "â¸ï¸ Pause Walk";
    }
  };

  document.getElementById("endWalk").onclick = function() {
  if (timerInterval !== null) {
    clearInterval(timerInterval);
    timerInterval = null;

    let finalTime = document.getElementById("timer").textContent;

    // ---- Get latest journal entry ----
    let entries = JSON.parse(localStorage.getItem("journalEntries")) || [];
    let lastFeeling = entries.length > 0 ? parseInt(entries[0].feeling) : null;

    // ---- Motivational messages by mood ----
    const messages = {
      low: [
        "Proud of you for showing up even on tough days ğŸ’ª",
        "Small steps are still progress. Keep going ğŸŒ±",
        "Resilience is built one walk at a time ğŸ”‘"
      ],
      mid: [
        "Every step counts, keep building resilience ğŸš¶",
        "Consistency beats intensity. Youâ€™ve got this ğŸ”¥",
        "Another walk done â€” youâ€™re making it a habit ğŸ•’"
      ],
      high: [
        "Nice! Youâ€™re building great momentum ğŸ”¥",
        "Solid effort today, your streak is growing ğŸ“ˆ",
        "Great job pushing through â€” keep the energy up âš¡"
      ],
      peak: [
        "Amazing energy today, keep shining âœ¨",
        "You crushed it! Walks like this fuel resilience ğŸš€",
        "Thatâ€™s champion-level consistency ğŸ‘‘"
      ]
    };

    // ---- Pick a message ----
    let moodMessage = "Great job walking today!";
    if (lastFeeling !== null) {
      if (lastFeeling <= 3) {
        moodMessage = messages.low[Math.floor(Math.random() * messages.low.length)];
      } else if (lastFeeling <= 6) {
        moodMessage = messages.mid[Math.floor(Math.random() * messages.mid.length)];
      } else if (lastFeeling <= 8) {
        moodMessage = messages.high[Math.floor(Math.random() * messages.high.length)];
      } else {
        moodMessage = messages.peak[Math.floor(Math.random() * messages.peak.length)];
      }
    }

    // ---- Show popup ----
    alert("ğŸ‰ Congratulations! Your walk today was " + finalTime + " long!\n\n" + moodMessage);

    // ---- Reset timer ----
    totalSeconds = 0;
    isPaused = false;
    updateTimer();
    document.getElementById("pauseWalk").textContent = "â¸ï¸ Pause Walk";
  }
};


  // initialize
  updateTimer();
  updateStreak();
</script>
<h3 id="streak">ğŸ”¥ Streak: 0 days</h3>
<script>
  // Apply saved theme on page load
  window.onload = function() {
    let theme = localStorage.getItem("theme") || "default";
    applyTheme(theme);
  };

  function applyTheme(theme) {
    let body = document.body;

    if (theme === "default") {
      body.style.backgroundColor = "#425af5";
      body.style.color = "#ffffff";
    } else if (theme === "dark") {
      body.style.backgroundColor = "#000000";
      body.style.color = "#ffffff";
    } else if (theme === "garnetGold") {
      body.style.backgroundColor = "#782F40";
      body.style.color = "#CEB888";
    } else if (theme === "purple") {
      body.style.backgroundColor = "#440b5c";
      body.style.color = "#000000";
    }
  }
</script>

</body>
</html>
